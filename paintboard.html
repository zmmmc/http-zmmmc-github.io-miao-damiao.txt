<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<style>
  div {
    width: 100%;
    height: 800px;
    border: 1px solid black;
    position: relative;
  }

  .dot {
    width: 8px;
    height: 8px;
    border-radius: 55px;
    position: absolute;
  }

  svg {
    width: 100%;
    height: 800px;
    position: absolute;
  }

  input {
    margin-left: 10px;
    vertical-align: bottom;
  }
</style>

<body>
  <div>
    <svg></svg>
  </div><br>
  颜色 <input type="color" id="colorInput">
  线条粗细 <input type="range" id="lineWidth" min="1" max="18" value="2">
  <span>2</span>
  <script>
    let draw = false
    let div = document.querySelector("div")

    let svg = document.querySelector("svg")
    let lastPos = null

    document.addEventListener("mousedown", function (e) {

      let g = document.createElementNS("http://www.w3.org/2000/svg", "g")
      function move(e) {

        // console.log(e)
        let pos = mousePos(svg)
        //创建svg元素 g来保存一条线的信息
        let line = document.createElementNS("http://www.w3.org/2000/svg", "line")
        if (lastPos == null) {
          line.setAttribute("x1", pos.x)
          line.setAttribute("y1", pos.y)
        } else {
          line.setAttribute("x1", lastPos.x)
          line.setAttribute("y1", lastPos.y)
        }
        line.setAttribute("x2", pos.x)
        line.setAttribute("y2", pos.y)
        //设置线条颜色
        line.setAttribute("stroke", colorInput.value)
        //设置线条的宽度
        line.setAttribute("stroke-width", lineWidth.value)
        //设置线条的边缘性质，默认为"butt"，无外包长方形的边角，"round"，圆形边角，"square"外包长方形边角
        line.setAttribute("stroke-linecap", "round")

        lastPos = pos
        //将画的内容放入g标签中,将g放入svg画板里
        svg.append(g)
        g.append(line)

      }
      document.addEventListener("mousemove", move)
      document.addEventListener("mouseup", function () {
        lastPos = null
        // draw = false
        document.removeEventListener("mousemove", move)
      })
    })

    //当svg存在时，按住ctrl+z键撤销svg创建的最后一个元素
    document.addEventListener("keydown", e => {
      if (e.key == "z" && e.ctrlKey) {
        svg.lastElementChild && svg.removeChild(svg.lastElementChild)
      }
    })


    let lineWidth = document.querySelector("#lineWidth")
    let span = document.querySelector("span")
    lineWidth.addEventListener("input", e => {
      span.textContent = lineWidth.value
    })

    function mousePos(node) {
      //getBoundingClientRect()返回一个元素的大小及其相对于视口的位置。
      let box = node.getBoundingClientRect()
      return {
        x: window.event.clientX - box.x,
        y: window.event.clientY - box.y,
      }
    }
  </script>
</body>

</html>
